<?php

require_once __DIR__ . "/../aa_kon_sett.php";
require_once __DIR__ . "/../src/utils/Logger.php";

$logFileName = 'cron_update_kategori_trans_b.log';
$logger = new AppLogger($logFileName);

$logger->info("mulai buat nge Update Kategori Trans B.");

$queries = [
    "UPDATE trans_b SET type_kategori='BABY' WHERE kode_supp IN ('A10001','A18001','A20001','A30001','A31','A31001','A39001','A39002','A40001','A40002','A41001','A42001','A43001','A50001','A60001','A80001','A8B001','A90001','B12001','B18001','B28','B28001','C10','C10001','C10002','C14001','C16001','C17001','C18001','C19','C19001','C20002','C40001','C50001','C70001','D20002','D28001','D29001','D9','D90001','D9B001','E11001','E11A01','E12001','E16001','E17001','E18001','E19001','E40001','E80001','F10001','F13001','F16','F16001','F17001','F19','F19001','F21001','F23001','F24001','F25001','F27001','F28001','F29001','F50001','F90001','G11','G11001','G12001','G14001','G60001','G6001','G6A001','G6B001','G7','G70001','G90001','H11001','H11A01','H7','H70001','L07301','L07401','L074A','L074A0','L074A01','L074A1','MDS001','MEDISOFT','BUMBOO')",
    "UPDATE trans_b SET type_kategori='DST' WHERE kode_supp IN ('A04601','A07601','A07901','A126001','A12601','A16201','B04401','L01501','L01502','L02501','L06901','L07501','L07901','L08101','L08801','L09501','L09701','M23201','MSK001','S01001','S01002','A40','ARNT01','D10A0A','D71001','GF0001','HDC001','L09801','MTS','NPL001','OT0001','OTS001','SERBA','SSR001','A00201','A11001','A19001','A28','A28001','A33001','A34001','A38001','AAM001','ABN001','AJP002','AJP004','ANK002','ANK003','ASK001','ASKP01','ASOKA','B15001','B22001','B30','B30001','B30002','B40001','B40002','B50001','B50002','B52201','B60','B60002','B70001','B70002','B79001','B90001','B90002','B92001','B95001','B99001','BAM001','BLR001','BPP001','CHO2','CIMORY','COCA-COLA','D15001','D20001','D60001','DEE2','DOREMI','DTL001','EAGLE','EAGLE0','EAGLE01','EAGLEO','F00301','F00303','G01002','G02801','G15001','H13001','J04801','J05601','J08801','J09001','J09002','J09301','K00201','K00701','K01002','K02201','K03701','K04701','K05501','K05901','K06101','K06102','K061A0','K08801','K10001','KMF001','L00601','L07801','L097','LBC001','LION STAR','LS0001','M39901','M47501','M47502','M499','M49901','MTM001','MTS001','NNT002','PAPERBAG','PAS001','PPR001','PREMIER','PUSAT SPM','REDHOUSE','RH0001','SEASON','SELECTION','SHIN HUA','SSN','SSN001','SSR002','TAL001','TAS001','VIOLA','VIOLA0','VIOLA01','VIOLAO')",
    "UPDATE trans_b SET type_kategori='SPM' WHERE kode_supp IN ('BBO001','BDR001','BEBELAC','BEE001','BEEME','BHP001','BMB0001','BMB001','CALADINE','CB0001','CSA001','CSA002','D10001','D10A01','D10A02','D10B01','D10C01','D10C02','D11001','D24001','D30001','D30002','D31001','D32001','D34001','D35001','D36001','D39001','D39A01','D40','D40001','D40002','D43001','D44001','D45001','D46001','D47001','D48001','D49001','D50001','D50002','D51001','D52001','D53001','D54001','D55001','D56001','D57001','D58001','D58A001','D58A01','D59001','D60002','D61001','D62001','D63001','D64001','D65001','D66001','D67001','D68001','D69001','D70002','D71001','D72001','D73001','D74001','D80001','DANCOW','E60001','ENZ001','ESKULIN','EZM001','F70001','F7A001','G13001','G16001','G17001','G18001','G19001','G20001','G20002','G30001','G40001','G40002','G4A001','GREENFIELDS','GSL001','H10001','H20001','HH0001','HNE001','HNZ001','ICHI OCHA','JB0001','JMK001','JORDAN','JSM001','JSM002','KDM001','KHONGGUAN','KINDER JOY','KNC001','KSA001','LISTING','LTC001','LTG001','MAKUKU','MAPO','MDJ001','MDJ002','MKK001','MKP001','MM0001','MMO001','MNJ001','MNM001','MNS001','MOELL','MOELL0','MOMAMI','MOMOGI','MORINAGA GOLD','MORINAGA PLT','MP0001','MRG002','MRG003','MRS001','NBK001','NNT001','NNW002','NUTRILON','ORAL-B','PEDIASURE','PKO001','POCARI','PSO001','S26001','SGM','SNR001','SNS001','SNS002','SWT001','TEM002','TSS001','TYK001','ZS0001','ZWT001','BBL001','DCW001','ENF001','LTW001','NTR001','PDS001','SGM001','VDR001','FF0001','WGS001','AQUA','FORMULA','LARUTAN KAKI 3','ULTRAMILK','UNILEVER','WINGS','YAKULT','YOU_C')",
    "UPDATE trans_b SET subdept='7112' WHERE barcode IN ('700017622','700017772','700017772','300875125281','300875127650','300875127650','4800361347631','4800361347631','4800361347815','4800361347815','5099864016475','5099864016505','7613032526313','7613032526498','7613032526542','8426594091217','8445290837356','8445290837356','8445290837387','8445290837387','8445290837516','8445290837516','8445290837516','8710428019707','8712045015797','8712045015797','8712045015797','8712045016596','8712045016596','8712045016633','8712045016633','8712045016633','8712045016749','8712045016749','8712045017074','8712045017074','8712045017074','8712045017074','8712045017678','8712045021811','8712045021811','8712045021811','8712045028216','8712045032367','8712045032367','8886451002822','8886451002853','8886451002853','8886451002877','8886451002877','8886451002891','8886451002907','8886451002914','8886451006394','8886451006394','8886451006394','8886451006394','8886451006394','8886451007414','8886451007414','8886472103133','8886472103140','8886472103928','8886472103928','8886472105090','8886472105090','8886472105816','8886472105816','8990057806309','8990057806408','8990057816315','8990057816414','8990057882716','8990057882723','8990057882723','8990057882730','8990057882730','8990057882747','8990057882754','8990057882761','8990057882761','8990057981020','8990057981020','8990057981037','8990057981037','8990057982713','8990057982720','8990057982737','8990057982744','8990057982744','8990057982751','8990057982768','8990443716076','8990443716076','8992696405585','8992696407053','8992696407688','8992696407701','8992696427280','8992696427303','8992696427327','8992696427358','8992696521544','8992696521544','8992696521872','8992696521896','8992696523043','8992696523043','8992696523043','8992696523234','8992696523234','8992696523241','8992696523241','8992696526341','8992696526464','8992753281701','8992753281701','8992753283705','8992753283705','8992753881703','8992753881703','8992753883707','8992802001137','8992802001137','8992802001137','8992802001144','8992802001144','8992802001144','8992802001144','8992802001144','8992802001151','8992802001151','8992802001151','8992802001151','8992802001151','8992802002042','8992802002059','8992802002059','8992802002059','8992802002066','8992802002066','8992802003018','8992802003018','8992802003018','8992802003018','8992802003025','8992802003025','8992802003025','8992802003032','8992802003032','8992802003032','8992802003032','8992802003049','8992802003049','8992802003049','8992802004015','8992802004015','8992802004022','8992802004022','8992802004022','8992802004039','8992802004046','8992802004046','8992802006026','8992802009010','8992802009010','8992802009027','8992802009027','8992802065054','8992802065061','8992802066068','8992802066075','8992802067119','8992802067119','8992802067119','8992802067133','8992802067140','8992802067140','8992802069021','8992802070027','8992802071024','8992802075015','8992802075015','8992802075015','8992802075022','8992802075022','8992802080019','8992802080026','8992802080026','8992802080033','8992802080033','8992802080033','8992802108010','8992802108027','8992802108065','8992802108065','8992802108072','8992802108089','8992802108096','8992802108096','8992802108126','8992802108126','8992802108133','8992802108133','8992802120081','8992802120111','8992802120166','8992802120173','8992802120180','8992802120180','8992802120197','8992802129039','8992802129077','8992802140010','8992802140010','8992802140010','8992802140010','8992802140041','8992802140041','8992802140041','8992802140041','8992802180016','8992802180016','8992802180016','8992802180016','8992802180030','8992802180030','8992802180030','8992802180085','8992802180085','8992802180085','8992802180085','8992802180146','8992802180146','8992802180146','8992802180146','8992802180153','8992802180153','8992802180153','8992802180153','8992802180153','8992802180160','8992802180160','8992802180160','8992802435000','8992802435000','8999099920486','8999099920486','8999099920486','8999099920561','8999099920561','8999099920691','8999099920691','8999099920714','8999099920714','8999099920738','8999099920752','8999099920752','8999099920776','8999099923517','8999099923531','8999269100212','8999269100212','8999269420211','8999269430210','8999269430289','8999269430289','8999269440288','8999269460040','8999269471046','8999269471046','8999269481045','8999269491044','8999269541046','8999908439505','8999908439703','8999908439703','8999908439901','8999908439901','8999908440105','8886451002860')"
];

mysqli_begin_transaction($conn);
$logger->info("mulai transaction db.");

try {
    foreach ($queries as $index => $sql) {
        if (mysqli_query($conn, $sql)) {
            $affected_rows = mysqli_affected_rows($conn);
            $logger->info("Query ke-" . ($index + 1) . " berhasil. $affected_rows baris terpengaruh.");
        } else {
            throw new Exception("Query ke-" . ($index + 1) . " gagal: " . mysqli_error($conn));
        }
    }
    
    mysqli_commit($conn);
    $logger->info("Transaksi BERHASIL. Semua kategori telah diupdate.");

} catch (Exception $e) {
    mysqli_rollback($conn);
    $logger->error("Transaksi GAGAL. Rollback dilakukan. Error: " . $e->getMessage());
}

mysqli_close($conn);
$logger->info("Koneksi database ditutup. Cron job selesai.");

?>